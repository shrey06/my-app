currentBuild.displayName = "MyAppBuild#" + currentBuild.number
pipeline{
  agent any
  stages{
      stage("Code Checkout"){
        steps{
          git branch: 'devops', url: 'https://github.com/gauravjadhav8/my-app'
        }
      }
      stage("Compile-Package"){
        steps{
              sh "mvn clean package"
          }
      }
      stage("Push to DockerHub"){
        steps{
            withDockerRegistry(credentialsId: 'ecr:ap-south-1:aws-ecr-gaurav', url: 'https://612359323314.dkr.ecr.ap-south-1.amazonaws.com/mytestapp') {
                script {
                    def newImg = docker.build "612359323314.dkr.ecr.ap-south-1.amazonaws.com/mytestapp:peace"
                    newImg.push()
                }
           }
        }
      }
      stage("Email Notification"){
        steps{
           mail bcc: '', body: 
           '''Hi Welcome to jenkins email alerts
           Thanks
           Lend.in''',
           cc: '',
           from: '',
           replyTo: '',
           subject: 'Jenkins Job',
           to: 'shrey.bhasin@kuliza.com'
        }
      }
   }
}
